<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Download soundcloud songs</title>
</head>
<style type="text/css">
	h1 {
    	font-family: 'Carrois Gothic', sans-serif;
	}

	#mainDiv {
	}

	#downloadLinkDiv {
		margin: auto;
	}

	#downloadLinkDiv div {

	}
</style>
<script>
	var client_id = "376f225bf427445fc4bfb6b99b72e0bf";

	function myFunction () {
		var downloadLinkDiv = document.getElementById("downloadLinkDiv");
		downloadLinkDiv.innerHTML = "";
		var q = document.getElementById("songsearch").value;
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function () {
			if(xhr.readyState == 4){
				if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304){
					var tracksList = JSON.parse(xhr.responseText);
					var linkCount = 0;
					//download links
					function getNextDownloadLink () {
						var trackListObject = tracksList[linkCount];
						if (trackListObject == undefined){
							return;
						}
						var track_download_url = "http://api.soundcloud.com/i1/tracks/"+trackListObject.id+"/streams?client_id="+client_id;
						var xhr = new XMLHttpRequest();
						xhr.onreadystatechange = function () {
							if(xhr.readyState == 4){
								if (((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) && linkCount < tracksList.length){
									var trackLink = JSON.parse(xhr.responseText);
									var downloadLink = trackLink.http_mp3_128_url;
									var downloadDiv = document.createElement("div");
									var downloadHref = document.createElement("a");
									downloadHref.setAttribute("href",downloadLink);
									downloadHref.setAttribute("download",trackListObject.title);
									downloadHref.appendChild(document.createTextNode(trackListObject.title));
									downloadDiv.appendChild(downloadHref);
									downloadLinkDiv.appendChild(downloadDiv);
									++linkCount;
									getNextDownloadLink();
								}
							}
						};
						xhr.open("get",track_download_url,true);
						xhr.send(null);
					}
					getNextDownloadLink();
				}else{
					// Error Message
				}
			}
		};
		var tracks_list_url = "http://api.soundcloud.com/tracks?"+"q="+encodeURIComponent(q)+"&client_id="+client_id;
		xhr.open("get",tracks_list_url,true);
		xhr.send(null);
		//alert(showstring);
		return false;
	}
</script>
<body>
	<h1>Download soundcloud songs</h1>
	<div id = "mainDiv">
		<form onsubmit="return myFunction()">
			<input id="songsearch" type="text" required>
			<input type="submit" value="Search">
		</form>
		<div id="downloadLinkDiv"></div>
	</div>
</body>
</html>